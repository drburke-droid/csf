<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BurkeCSF</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>

    <!-- Calibration Guard -->
    <div id="cal-guard" style="display:none;">
        <h2>Calibration Required</h2>
        <p>Display calibration is needed for accurate measurement. Connect your phone to begin.</p>
        <button onclick="window.location.href='calibration.html'">Begin Calibration</button>
    </div>

    <!-- QR Sync Overlay -->
    <div id="sync-overlay">
        <div class="sync-title">BurkeCSF</div>
        <div class="sync-subtitle">Contrast Sensitivity Function</div>
        <div id="qrcode"></div>
        <div class="sync-subtitle">Scan with your phone to connect</div>
        <div id="sync-debug" style="font-family:var(--mono,'monospace');font-size:0.45rem;color:rgba(255,255,255,0.15);margin-top:4px;"></div>
        <button class="sync-dismiss-btn" onclick="document.getElementById('sync-overlay').style.display='none'">
            Use Keyboard Instead
        </button>
    </div>

    <!-- Display Frame -->
    <div class="display-frame" id="mirror-target">
        <canvas id="stimCanvas" width="600" height="600"></canvas>
        <div class="hud">
            <span class="hud-mode" id="mode-label">—</span>
            <div class="progress-track"><div class="progress-fill" id="progress-fill"></div></div>
            <span class="hud-progress" id="live-progress">0 / 50</span>
        </div>
    </div>

    <!-- Results — all children centered via flexbox -->
    <div id="results-overlay">
        <div id="result-content">
            <div class="result-eyebrow">Area Under Log CSF</div>
            <div class="auc-value" id="final-auc">0.00</div>
            <div class="rank-label" id="final-rank">—</div>
            <div class="result-detail" id="final-detail"></div>
            <canvas id="csf-plot"></canvas>
            <button class="restart-btn" onclick="location.reload()">Test Again</button>
        </div>
    </div>

    <!-- Gear -->
    <div id="gear-btn" onclick="window.location.href='calibration.html'">⚙</div>
    <div id="stale-cal-warning" style="display:none;" onclick="window.location.href='calibration.html'">
        Calibration >24h old — recalibrate
    </div>

    <!-- Dependencies -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script>if(typeof Peer==='undefined'){var s=document.createElement('script');s.src='https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.5.2/peerjs.min.js';document.head.appendChild(s)}</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" onerror=""></script>
    <script type="module" src="app.js"></script>
</body>
</html>
